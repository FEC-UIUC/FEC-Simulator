<html>
<head>
	<title>Financial Engineering Club at Illinois | FEC | Home</title>
	<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,300,700,100' rel='stylesheet' type='text/css'>
        <link href='http://fec.ec.illinois.edu/main/css/style.css' rel='stylesheet' type='text/css'>
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script src="http://code.highcharts.com/stock/highstock.js"></script>
        <script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
	<script src="js/chart.js"></script>
        <script>
	
		$(function(){
			$('#header').load("http://fec.ec.illinois.edu/header.php"); 
			messages = document.getElementById("messages");
			makeChart();
		}); 
		
		var webSocket;
		var messages;
	  
		function openSocket(){
			if(webSocket !== undefined && webSocket.readyState !== WebSocket.CLOSED){
			   writeResponse("WebSocket is already opened.");
				return;
			}

			webSocket = new WebSocket("ws://localhost:8080/Simulator/server");
			 
			webSocket.onopen = function(event){
				if(event.data === undefined)
					return;
				writeResponse(event.data);
			};

			webSocket.onmessage = function(event){
			
				msg = event.data.split("|");
				if(msg[0] == 'message'){
                                   m = "<b>" + msg[1] + ":</b> " + msg[2]; 
  				   writeResponse(m);
				} else {
  				   var series = stockchart.series[0];
				   var x = (new Date()).getTime()
				   var y = $.parseJSON(msg[1]);
				   if(y != null){
				     series.addPoint([x,y], true, true);
				   }
                                   $("#price-box").html(y.toString());
				}
			};

			webSocket.onclose = function(event){
				writeResponse("Connection closed");
			};
		}
		
		function startData(){
		   webSocket.send("admin|start");
		}
		
		function stopData(){
		   webSocket.send("admin|stop");
		}
	   
		function send(){
			var text = document.getElementById("messageinput").value;
			webSocket.send("message|" + text);
		}
	   
		function closeSocket(){
			webSocket.close();
		}

		function writeResponse(text){
			messages.innerHTML += "<br/>" + text;
		}
		
		
	</script>
</head>
<body>
<div id="header"></div>
<div id="content">
<br>
<span id="form-notification"></span><br> 
<br>
  <div id="chart-area"></div>
  
  <div>
	<input type="text" id="messageinput"/>
  </div>
  <div style="float:left;">
	<button type="button" onclick="openSocket();" >Open</button>
	<button type="button" onclick="send();" >Send</button>
	<button type="button" onclick="closeSocket();" >Close</button> <br>
	<button type="button" onclick="startData();" >Start</button>
	<button type="button" onclick="stopData();" >Stop</button>
  </div>
  <div id="price-box" style="float:left;border:1;">
	
  </div>
  <br>
  <!-- Server responses get written here -->
  <div id="messages"></div>

</div>
</body>
</html>